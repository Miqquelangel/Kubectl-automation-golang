# kubectl-automation-golang

## INTRODUCTION

When it comes to inspect, create or debug resources in a kubernetes cluster, `kubectl` commands can get too tedious to execute. A living example would be to inspect a pod by accessing via shell, having long pod names and long namespaces.

Imagine a pod misbehaving and having to enter a bash session to inspect it further:

`kubectl exec -it <pod_name> -n <namespace> -- /bin/bash`
|---|

What if we just execute the command `kexec`, and prompt us with the pod name to access and the corresponding shell? 

That is the main intention of this repository, the creation of basic Go scripts that will parse (detect automatically the namespace) of a given resource and make the `kubectl` more easy to interact with. 

## USE CASES

### 1.- Access pod shell
We have the following pod and namespace:

<img align="center" width="1200" src="https://github.com/Miqquelangel/Kubectl-automation-golang/blob/main/assets/pod.png">

If I want to access that pod through a bash shell, I will have to execute:

`kubectl exec -it nginx-foo-reed-7c79c4bf97-f96tf -n production -- /bin/bash`
|---|

With these Go scripts, it gets down to this:

<img align="center" width="1200" src="https://github.com/Miqquelangel/Kubectl-automation-golang/blob/main/assets/kexec.png">

We just execute `kexec`
|---|

It will ask for the pod name, we paste it. It will automatically its namespace.
|---|

It will prompt us which shell we want.
|---|

### 2.- Describe a pod

Let’s imagine that we have to describe a pod, with this new formula, it gets down to this:

<img align="center" width="1200" src="https://github.com/Miqquelangel/Kubectl-automation-golang/blob/main/assets/kdespod.png">

A simple `kdespod` which will prompt the pod to be described, and will automatically detect on which namespace is located.

### 3.- Logs of a container

Suppose that we need to inspect the logs generated by the `istio-proxy` container injected in a pod, with these scripts, it gets down to this!

<img align="center" width="1200" src="https://github.com/Miqquelangel/Kubectl-automation-golang/blob/main/assets/klogsontainer.png">

We execute `klogscontainer`.
|---|

It will ask the container name to extract logs.
|---|

It will ask the pod where this container is hosted, and will detect the namespace of the pod automatically!
|---|

Therefore, we dont need to execute this long command, keeping in mind the namespace... Just with the names of the container and pod its enough.

`kubectl logs nginx-foo-reed-7c79c4bf97-f96tf -n production -c istio-proxy`
|---|

## SETUP

The logic behind it is very simple. The commands will call aliases that themselves will call the scripts. To set this up we must follow the following.

1.- Installing Golang in your environment using the following official guide:

[Golang installation](https://go.dev/doc/install)
|---|

2.- Create the `/scripts` path, paste the Go scripts of this repository into the directory we’ve created and append the `.bashrc` aliases (Debian) of this repository to the your current `.bashrc` configuration file. All of this can be done by execute the following command:

```bash
mkdir /scripts
git clone https://github.com/Miqquelangel/Kubectl-automation-golang.git
cp Kubectl-automation-golang/scripts/* /scripts/
rm -rf Kubectl-automation-golang/
wget -O - https://raw.githubusercontent.com/Miqquelangel/Kubectl-automation-golang/main/.bashrc >> /root/.bashrc
source /root/.bashrc
```


If you installed Go, and executed the command above, you should be able to start using your new aliases!

The scripts are as basic as they can get, however, it offers speed while inspecting resources once you familiarize yourself with the aliases.

Feel free to inspect the file `.bashrc` to know which aliases are supported. It supports some resources relevant to GCP and Istio. Due to the simplicity of the scripts, you can tweak them to make further functionalities.
